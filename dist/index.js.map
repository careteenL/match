{"version":3,"file":"index.js","sources":["../src/util.js","../src/validate.js","../src/index.js"],"sourcesContent":["import {\n  isString,\n  isObject,\n  isFunction\n} from '@careteen/is'\n\nexport function isTemplate(v) {\n  return isString(v) && /{{([^}]+)}}/.test(v)\n}\n\nexport function hasOwn(object, p) {\n  return Object.prototype.hasOwnProperty.call(object, p)\n}\n\nexport function map(src, rules, config) {\n  let out = config.fill ? Object.assign({}, src) : {}\n  // 如需过滤，先过滤原对象\n  if (config.filter) {\n    for (let skey in src) {\n      if (config.filter.indexOf(src[skey]) >= 0) {\n        delete out[skey]\n      }\n    }\n  }\n  // 根据规则转化\n  for (let rkey in rules) {\n    let rule = rules[rkey]\n    try {\n      if (isFunction(rule)) {\n        out[rkey] = rule.call({}, src) // 注入参数$scope为当前对象\n      } else if (isTemplate(rule)) {\n        let exp = rule.replace(/{{/g, 'src.').replace(/}}/g, '')\n        out[rkey] = eval('' + exp + '') // eval！！简单表达式\n      } else if (isObject(rule)) {\n        out[rkey] = map({}, rule, config) // 对象递归转换\n      } else {\n        out[rkey] = rule // 默认不转换\n      }\n      // 如需过滤，转化完后再过滤\n      if (config.filter && config.filter.indexOf(out[rkey]) >= 0) {\n        delete out[rkey]\n      }\n    } catch (e) {\n      console.error(e)\n      // 这种异常开发阶段规避不了，所以需要确保异常数据OK\n      if (config.filter.indexOf(null) >= 0) {\n        delete out[rkey]\n      } else {\n        out[rkey] = null\n      }\n    }\n  }\n  return out\n}","import {\n  isObject,\n  isArray\n} from '@careteen/is'\n\nexport function _validConfig(config) {\n  if (!isObject(config)) {\n    throw new Error(\n      '第三个参数-配置必须为object类型, {fill: false, filter:[null]}'\n    )\n  }\n  if (config.filter && !isArray(config.filter)) {\n    throw new Error(\n      '第三个参数-配置filter项必须为Array类型, {fill: false, filter:[null]}'\n    )\n  }\n  return true\n}","/**\n * @desc 对象/数组属性映射 主要解决前后端并行开发或前端先行开发带来的命名不统一问题\n * @param {Object|Array} src 源对象\n * @param {Object} rules 描述匹配规则的对象\n * @param {Object} config fill:填充, filter: 过滤 {fill: true, filter: [null, '']}\n * @return {Object|Array}\n */ \nimport { isArray } from '@careteen/is'\n\nimport { map } from './util'\n\nimport { _validConfig } from './validate'\n\nexport default function match(\n  src = {},\n  rules,\n  config = { fill: false, filter: [] }\n) {\n  let out = []\n\n  if (!_validConfig(config)) {\n    return\n  }\n\n  if (isArray(rules)) {\n    // match(data, ['id'])\n    if (!isArray(src)) {\n      src = [src]\n    }\n    src.forEach(skey => {\n      if (config.filter.indexOf(skey[rules[0]]) < 0) {\n        out.push(skey[rules[0]])\n      }\n    })\n    return out\n  }\n\n  if (isArray(src)) {\n    // match(data, {pid: '{{id}}'})\n    src.forEach((s, sIdx) => {\n      // #1217 为数组每项新增下标标识\n      s._index = sIdx\n      out.push(map(s, rules, config))\n    })\n  } else {\n    out = {}\n    out = map(src, rules, config)\n  }\n  return out\n}\n"],"names":["isTemplate","v","isString","test","map","src","rules","config","out","fill","Object","assign","filter","skey","indexOf","rkey","rule","isFunction","call","exp","replace","eval","isObject","e","console","error","_validConfig","Error","isArray","match","forEach","push","s","sIdx","_index"],"mappings":";;;;;;;;;;;EAMO,SAASA,UAAT,CAAoBC,CAApB,EAAuB;EAC5B,SAAOC,YAASD,CAAT,KAAe,cAAcE,IAAd,CAAmBF,CAAnB,CAAtB;EACD;;AAMD,EAAO,SAASG,GAAT,CAAaC,GAAb,EAAkBC,KAAlB,EAAyBC,MAAzB,EAAiC;EACtC,MAAIC,MAAMD,OAAOE,IAAP,GAAcC,OAAOC,MAAP,CAAc,EAAd,EAAkBN,GAAlB,CAAd,GAAuC,EAAjD;EACA;EACA,MAAIE,OAAOK,MAAX,EAAmB;EACjB,SAAK,IAAIC,IAAT,IAAiBR,GAAjB,EAAsB;EACpB,UAAIE,OAAOK,MAAP,CAAcE,OAAd,CAAsBT,IAAIQ,IAAJ,CAAtB,KAAoC,CAAxC,EAA2C;EACzC,eAAOL,IAAIK,IAAJ,CAAP;EACD;EACF;EACF;EACD;EACA,OAAK,IAAIE,IAAT,IAAiBT,KAAjB,EAAwB;EACtB,QAAIU,OAAOV,MAAMS,IAAN,CAAX;EACA,QAAI;EACF,UAAIE,cAAWD,IAAX,CAAJ,EAAsB;EACpBR,YAAIO,IAAJ,IAAYC,KAAKE,IAAL,CAAU,EAAV,EAAcb,GAAd,CAAZ,CADoB;EAErB,OAFD,MAEO,IAAIL,WAAWgB,IAAX,CAAJ,EAAsB;EAC3B,YAAIG,MAAMH,KAAKI,OAAL,CAAa,KAAb,EAAoB,MAApB,EAA4BA,OAA5B,CAAoC,KAApC,EAA2C,EAA3C,CAAV;EACAZ,YAAIO,IAAJ,IAAYM,KAAK,KAAKF,GAAL,GAAW,EAAhB,CAAZ,CAF2B;EAG5B,OAHM,MAGA,IAAIG,YAASN,IAAT,CAAJ,EAAoB;EACzBR,YAAIO,IAAJ,IAAYX,IAAI,EAAJ,EAAQY,IAAR,EAAcT,MAAd,CAAZ,CADyB;EAE1B,OAFM,MAEA;EACLC,YAAIO,IAAJ,IAAYC,IAAZ,CADK;EAEN;EACD;EACA,UAAIT,OAAOK,MAAP,IAAiBL,OAAOK,MAAP,CAAcE,OAAd,CAAsBN,IAAIO,IAAJ,CAAtB,KAAoC,CAAzD,EAA4D;EAC1D,eAAOP,IAAIO,IAAJ,CAAP;EACD;EACF,KAfD,CAeE,OAAOQ,CAAP,EAAU;EACVC,cAAQC,KAAR,CAAcF,CAAd;EACA;EACA,UAAIhB,OAAOK,MAAP,CAAcE,OAAd,CAAsB,IAAtB,KAA+B,CAAnC,EAAsC;EACpC,eAAON,IAAIO,IAAJ,CAAP;EACD,OAFD,MAEO;EACLP,YAAIO,IAAJ,IAAY,IAAZ;EACD;EACF;EACF;EACD,SAAOP,GAAP;EACD;;EChDM,SAASkB,YAAT,CAAsBnB,MAAtB,EAA8B;EACnC,MAAI,CAACe,YAASf,MAAT,CAAL,EAAuB;EACrB,UAAM,IAAIoB,KAAJ,CACJ,mDADI,CAAN;EAGD;EACD,MAAIpB,OAAOK,MAAP,IAAiB,CAACgB,WAAQrB,OAAOK,MAAf,CAAtB,EAA8C;EAC5C,UAAM,IAAIe,KAAJ,CACJ,yDADI,CAAN;EAGD;EACD,SAAO,IAAP;EACD;;ECjBD;;;;;;;AAOA;AAMA,EAAe,SAASE,KAAT,GAIb;EAAA,MAHAxB,GAGA,uEAHM,EAGN;EAAA,MAFAC,KAEA;EAAA,MADAC,MACA,uEADS,EAAEE,MAAM,KAAR,EAAeG,QAAQ,EAAvB,EACT;;EACA,MAAIJ,MAAM,EAAV;;EAEA,MAAI,CAACkB,aAAanB,MAAb,CAAL,EAA2B;;EAI3B,MAAIqB,WAAQtB,KAAR,CAAJ,EAAoB;EAClB;EACA,QAAI,CAACsB,WAAQvB,GAAR,CAAL,EAAmB;EACjBA,YAAM,CAACA,GAAD,CAAN;EACD;EACDA,QAAIyB,OAAJ,CAAY,gBAAQ;EAClB,UAAIvB,OAAOK,MAAP,CAAcE,OAAd,CAAsBD,KAAKP,MAAM,CAAN,CAAL,CAAtB,IAAwC,CAA5C,EAA+C;EAC7CE,YAAIuB,IAAJ,CAASlB,KAAKP,MAAM,CAAN,CAAL,CAAT;EACD;EACF,KAJD;EAKA,WAAOE,GAAP;EACD;;EAED,MAAIoB,WAAQvB,GAAR,CAAJ,EAAkB;EAChB;EACAA,QAAIyB,OAAJ,CAAY,UAACE,CAAD,EAAIC,IAAJ,EAAa;EACvB;EACAD,QAAEE,MAAF,GAAWD,IAAX;EACAzB,UAAIuB,IAAJ,CAAS3B,IAAI4B,CAAJ,EAAO1B,KAAP,EAAcC,MAAd,CAAT;EACD,KAJD;EAKD,GAPD,MAOO;EACLC,UAAM,EAAN;EACAA,UAAMJ,IAAIC,GAAJ,EAASC,KAAT,EAAgBC,MAAhB,CAAN;EACD;EACD,SAAOC,GAAP;EACD;;;;;;;;"}